import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:http/http.dart' as http;

import 'package:image_search_clean/clean/data/pixabay_api.dart';
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';

@GenerateMocks([http.Client])
void main() {
  test('PixabayApi Test', () async {
    final api = PixabayApi();
    final client = MockClient();
    const query = 'apple';

    when(client.get(Uri.parse(
            '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=$query&image_type=photo')))
        .thenAnswer((_) async => http.Response(fakeJsonBody, 200));

    final result = await api.fetch(query, client: client);

    expect(result.length, 20);
    expect(result.first.id, 2788599);

    verify(client.get(Uri.parse(
        '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=$query&image_type=photo')));
  });
}

String fakeJsonBody = """
{"total":9363,"totalHits":500,"hits":[{"id":2788599,"pageURL":"https://pixabay.com/photos/apples-red-apple-ripe-apple-orchard-2788599/","type":"photo","tags":"apples, red apple, ripe","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/21/apples-2788599_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g3f79924914d016121ae89188e79d02327080d8ba60933a1dcb15537c6ff05b8494735a4289e74fe3e340682f48dbdac47814737702dc05956851147e9b8ddc19_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/geae2b4521f5532523308d2cad101c2d12933d1cc87c6675352fde46159e33bc0c8036f4cfbfb412f8150c724eb8ccfc47e5951e5efaaadd9eacd8ec7832c05bd_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":3660484,"views":162903,"downloads":91864,"collections":586,"likes":651,"comments":76,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":256261,"pageURL":"https://pixabay.com/photos/apple-books-still-life-fruit-food-256261/","type":"photo","tags":"apple, books, still life","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256261_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gc6d68a7a4eea50d90f6589ba9941b4bc66fba6c8a01433e8411bd3cda5a16f4ea4e83920fdf342ec2ad04a0db3c1ea2c_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g051de6368c3567b778c2082cb1071a171942ffd26be6a5cd3d3702611bb5856fffff716a0676ce9d40d131be123ef38f0008c3b14e219bf311540b3138c92963_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2987083,"views":597848,"downloads":334501,"collections":1026,"likes":1047,"comments":255,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":8027938,"pageURL":"https://pixabay.com/photos/apple-fruit-red-apple-sliced-apple-8027938/","type":"photo","tags":"apple, fruit, red apple","previewURL":"https://cdn.pixabay.com/photo/2023/05/30/08/34/apple-8027938_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g8520747f40a5488827363d96449a6742bdbe04275df6fb0f278a4f4bbf4b116bcfcabd99fbe5479e90fdb72896309c83b097409dbdbfd1af1aebf85b7be96c85_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g0615cea2559ee98a238d3f765ee9764291493167fdb924a68abc506db563dbc4a10775040c4df36db91c00209b5e6e038d3e2384a59400cc26042f63ac4db389_1280.jpg","imageWidth":5636,"imageHeight":3757,"imageSize":1044320,"views":6397,"downloads":4471,"collections":46,"likes":79,"comments":12,"user_id":4052317,"user":"MaxWdhs","userImageURL":"https://cdn.pixabay.com/user/2023/05/22/10-14-24-37_250x250.png"},{"id":256268,"pageURL":"https://pixabay.com/photos/apple-red-delicious-fruit-vitamins-256268/","type":"photo","tags":"apple, red, delicious","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/30/apple-256268_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gc818a93fcd7f622e752898d0ac335d5df2b78457119f951f2a2dddb9debb1795fa90e77a7b1366519cccaf92fe41c690_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g5d2255d8c6261805cd72c2fdb0d1b2dfff82ef926d4227d337bfb0e504f6733a1d8abc17fc764d725ff5335b5f23a5bd0e3ea560de9264815fab042ee0f24d54_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2942037,"views":101203,"downloads":53997,"collections":321,"likes":273,"comments":41,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":2788651,"pageURL":"https://pixabay.com/photos/apples-apple-tree-fruits-orchard-2788651/","type":"photo","tags":"apples, apple tree, fruits","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/39/apples-2788651_150.jpg","previewWidth":150,"previewHeight":77,"webformatURL":"https://pixabay.com/get/ge4b3c23ca23bfcef16203553205efb603aa2fffcc7e10aba916354dca6c6f857a06d792d34ede604bb7b30bd75efde9b0cc05a37efe50cdd7fe94dd3f25a2a8f_640.jpg","webformatWidth":640,"webformatHeight":330,"largeImageURL":"https://pixabay.com/get/g02f5adf1cb0a6ddecb5d8066bcb04c37745ba734d6a3f705e03f3a3b1b3e4e096006a322cb3fa0d9653d23a83a6003a4bc75c1774b73d59d3ec1d7dba9fdf5cc_1280.jpg","imageWidth":6000,"imageHeight":3103,"imageSize":2518838,"views":93075,"downloads":60863,"collections":492,"likes":478,"comments":53,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":256263,"pageURL":"https://pixabay.com/photos/apple-books-classroom-red-apple-256263/","type":"photo","tags":"apple, books, classroom","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256263_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gaa24f9689b230799f52636276a24d54235a69cf072aa68428b8295964ff5d62b32f0dab989a893131980da17473e6e52_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/gd02a67df47260a92b5acfcfcca866b6fa448e08d78d1e7a0611ba820f7140593339cac31b36489f158b0e064cee6b61f456d357e3138cf4031588fd4a391f6af_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2864273,"views":282016,"downloads":162485,"collections":624,"likes":563,"comments":109,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":8027944,"pageURL":"https://pixabay.com/photos/apple-fruits-tomato-red-apple-8027944/","type":"photo","tags":"apple, fruits, tomato","previewURL":"https://cdn.pixabay.com/photo/2023/05/30/08/34/apple-8027944_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/gf45e31f9197dc17d2902f051445126d97e0974a64fabb3be28575ce167b4356a0dc9c3ebbf9a3ff8a5b3811a0a29ef726b4f2511915e2ab2f147f0090a50628c_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/ga2a8ad50f3987fbb2c9b391968c5b8bdcb305e1e1f2b5565abff1b4dd9cb44e03317ee96a30763274dbe7c8630a8296fde804526f58a5872bf23879da08cda4a_1280.jpg","imageWidth":5636,"imageHeight":3757,"imageSize":795101,"views":11797,"downloads":9443,"collections":22,"likes":74,"comments":9,"user_id":4052317,"user":"MaxWdhs","userImageURL":"https://cdn.pixabay.com/user/2023/05/22/10-14-24-37_250x250.png"},{"id":1702316,"pageURL":"https://pixabay.com/photos/apple-red-fruit-red-chief-1702316/","type":"photo","tags":"apple, red, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/09/29/08/33/apple-1702316_150.jpg","previewWidth":150,"previewHeight":116,"webformatURL":"https://pixabay.com/get/gbb1dd153d8b6003b5d6da1c5368ca6c9e27cad28e5d34e9d93380aecbde8ab87f54e2676533f454e1d1e43088e7a96cf42e69fb2ebbedf2f7bbeed94aa39c353_640.jpg","webformatWidth":640,"webformatHeight":495,"largeImageURL":"https://pixabay.com/get/g1c1df0e088ea6ca6c4acc9626997ae25b2a37b3545e92c2312acb6667f59863f86de5452480c020eb6990eacfa33ee57d253ef06fc9f96a091e66fc305147c04_1280.jpg","imageWidth":4000,"imageHeight":3099,"imageSize":1930833,"views":170660,"downloads":114500,"collections":369,"likes":378,"comments":33,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":7458975,"pageURL":"https://pixabay.com/photos/harvest-fruit-apple-ripe-red-7458975/","type":"photo","tags":"harvest, fruit, apple","previewURL":"https://cdn.pixabay.com/photo/2022/09/16/16/09/harvest-7458975_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g0fc8347a5d7509dfa53eb13ffef9ee1a4076413c4f17441374d78a546463e811e4d11ad7160ec0820826567bc75d96f3bbafbf99ef92334b9edc25b68b981e53_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/gbe564c879af7a7305544f856237938f662b21b7155301d788cf1e3a2eb4312b3a8459c18c21d4ec2e0ea350b2e5ad2c33245752d1aa79e6dfabc7ea59a5ef5fa_1280.jpg","imageWidth":6118,"imageHeight":4079,"imageSize":3207237,"views":20599,"downloads":15174,"collections":74,"likes":101,"comments":14,"user_id":25753869,"user":"alandsmann","userImageURL":"https://cdn.pixabay.com/user/2022/02/17/14-57-12-27_250x250.jpg"},{"id":1122537,"pageURL":"https://pixabay.com/photos/apple-water-droplets-fruit-moist-1122537/","type":"photo","tags":"apple, water droplets, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/01/05/13/58/apple-1122537_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/gdfc3f8f40ea0b6939a56a688cdd5aacc99f267746becbe4990739bd8006bef1261fdf137088e46526ca19ba538cba8330350f057e1b91eecc3e5ac50dd071996_640.jpg","webformatWidth":640,"webformatHeight":409,"largeImageURL":"https://pixabay.com/get/g384952841435389640f7852653d59b19379bf4cbbf98326acedff10c219e39c4f65af648b9b8caed5708478d278265257e7f1d046fca48bb6f614fa0b74e3efe_1280.jpg","imageWidth":4752,"imageHeight":3044,"imageSize":5213632,"views":395117,"downloads":239987,"collections":1157,"likes":1269,"comments":200,"user_id":1445608,"user":"mploscar","userImageURL":"https://cdn.pixabay.com/user/2016/01/05/14-08-20-943_250x250.jpg"},{"id":1834639,"pageURL":"https://pixabay.com/photos/apple-red-fruit-food-fresh-ripe-1834639/","type":"photo","tags":"apple, red, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/11/18/13/47/apple-1834639_150.jpg","previewWidth":150,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g21b4b2cdcda0547ebe90f9fc683c406dffa9ba18e9e8d52a484b54aaf17a4906beaf40093f2907c536c8950f61674f16ed6123b93c382d3631392f1986723a3b_640.jpg","webformatWidth":640,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gc18e9648d10bd9f1a10c8ab7e507e1fe6ac8ae65323e08326fab915494fec66edae82b31bb4dd24bedb26b0df45e57e07e3c728688078720ebad91e1a8760363_1280.jpg","imageWidth":2827,"imageHeight":2827,"imageSize":1022194,"views":154101,"downloads":99295,"collections":321,"likes":273,"comments":66,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":2391,"pageURL":"https://pixabay.com/photos/apple-diet-female-food-fresh-2391/","type":"photo","tags":"apple, diet, female","previewURL":"https://cdn.pixabay.com/photo/2010/12/13/10/09/apple-2391_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g33c1ab86b5902d0e388590031e3072f68fc7fec6f64227955c56ca951e3088a97e562e8f6c059dd8376551feac68d571_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g2bd85a1a8a95924ed2159e9416a8f173455bea9949d91c3d6c1b71a0d3c44bbee7f50a4328c8e9d6f59834ec6993c3e6_1280.jpg","imageWidth":4752,"imageHeight":3168,"imageSize":752002,"views":157422,"downloads":106403,"collections":395,"likes":309,"comments":41,"user_id":14,"user":"PublicDomainPictures","userImageURL":"https://cdn.pixabay.com/user/2012/03/08/00-13-48-597_250x250.jpg"},{"id":5523590,"pageURL":"https://pixabay.com/photos/apple-fresh-tree-apple-orchard-5523590/","type":"photo","tags":"apple, fresh, tree","previewURL":"https://cdn.pixabay.com/photo/2020/08/28/05/36/apple-5523590_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g736d6dc15df71b3148fb205a22d190f5f7d74a4091f039802702c9a7d00547bf228a19009696bc3fc3867040fb4ab94e569044379d1fa1efa26ac25fedc252dc_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g38359d8798984cf79f9c33e42254dafa7e3d6e9ab1d992b8b148d6b7f5e4a67f4533c46cd855e55fd301d0c8407aa9e532d458c2fdcb4a95447772fdd10bd5a9_1280.jpg","imageWidth":6016,"imageHeight":4016,"imageSize":5173833,"views":30592,"downloads":24543,"collections":102,"likes":96,"comments":16,"user_id":14916592,"user":"keyouest","userImageURL":""},{"id":1532055,"pageURL":"https://pixabay.com/photos/apple-green-apple-tree-apple-tree-1532055/","type":"photo","tags":"apple, green apple, tree","previewURL":"https://cdn.pixabay.com/photo/2016/07/21/09/04/apple-1532055_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gae07891fd4aaf69f852595b30f409cb227c9f21c02b500237b87bcb8322dfc8a19b522b567d1f022cdae21a95de15b05482b61bb68bac3b8077a4a23201de67b_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g238f6ca4ad752d37d6546e491d7babc3e94294b36e7809af0cba1f9bb588249a690e89112d3dc1f7597500caae993e5573b1b9ab777b63be452085f7db95a266_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2842757,"views":116549,"downloads":67998,"collections":270,"likes":306,"comments":58,"user_id":509903,"user":"congerdesign","userImageURL":"https://cdn.pixabay.com/user/2023/11/06/12-07-49-892_250x250.jpg"},{"id":256262,"pageURL":"https://pixabay.com/photos/apple-book-still-life-red-apple-256262/","type":"photo","tags":"apple, book, still life","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256262_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gf7eda4d08275b5f048e671a148ffd1e1dff136e5eea310d257169c3e7a1c515af73934255bb763989b71e0c0e8c24466_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g81ec54c1b7c1f2414af43b2fc4d40d8b315389dacbb7df34e1cdbe11fa883d3c5e60c9f4c16c2486b0545dda398407b3fd64661d6973120c191108a2f1e5042e_1280.jpg","imageWidth":4500,"imageHeight":2981,"imageSize":2303151,"views":106425,"downloads":53967,"collections":253,"likes":233,"comments":30,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":3506215,"pageURL":"https://pixabay.com/photos/apple-fruit-food-fresh-healthy-3506215/","type":"photo","tags":"apple, fruit, food","previewURL":"https://cdn.pixabay.com/photo/2018/06/29/15/31/apple-3506215_150.jpg","previewWidth":150,"previewHeight":101,"webformatURL":"https://pixabay.com/get/gd33d394ec5b6ceb1be5103846bd4e7436ecc40cdb37af98211ce24c5ab4da67b313e6a806ed8ed805bfe158a8a1afc97a8b5e6df43398240ce608c91b272fba9_640.jpg","webformatWidth":640,"webformatHeight":435,"largeImageURL":"https://pixabay.com/get/g0c2abab77cbdbd5c051cef1eab45df353455d7f3a2c7a362e3ca7296d64853123a90543c3a5cda85963c33ca237d023a5ee9ed89906c35b1952b583ab1c06cdd_1280.jpg","imageWidth":5035,"imageHeight":3427,"imageSize":2028733,"views":20262,"downloads":15527,"collections":55,"likes":85,"comments":44,"user_id":1767157,"user":"Ralphs_Fotos","userImageURL":"https://cdn.pixabay.com/user/2024/05/26/04-18-55-608_250x250.jpg"},{"id":4055926,"pageURL":"https://pixabay.com/photos/apple-apple-tree-fruits-food-fresh-4055926/","type":"photo","tags":"apple, apple tree, fruits","previewURL":"https://cdn.pixabay.com/photo/2019/03/14/21/15/apple-4055926_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ge1bd71899e382f835b6bd5fe34e77fcd492f4d92f90bfe0cb38a6a3bb43b838994f657ecadbbdd0e65656a66b5b8242cac52e69e51d365c77274ce45ec92a14e_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g3ab7829b18f828d78821009f14a62a67023c8c0bb1c9d6fecd80c6a5fd58c50bd80bd9b8e6376798a71f7123ee7c38122174ceb10df704584f0ebf9c71e1a47e_1280.jpg","imageWidth":5184,"imageHeight":3456,"imageSize":6127596,"views":18940,"downloads":12004,"collections":72,"likes":101,"comments":35,"user_id":11059614,"user":"Lichtsammler","userImageURL":"https://cdn.pixabay.com/user/2019/03/04/09-41-51-213_250x250.jpg"},{"id":3535566,"pageURL":"https://pixabay.com/photos/apples-fruits-apple-tree-harvest-3535566/","type":"photo","tags":"apples, fruits, apple tree","previewURL":"https://cdn.pixabay.com/photo/2018/07/13/11/29/apples-3535566_150.jpg","previewWidth":150,"previewHeight":91,"webformatURL":"https://pixabay.com/get/gda968618f5957602a166ae2b4357e44d7ed645ab9d8765b511f1787ed10edbfac69ebc7ef9ede635b834c9c414e6ca928ebd6c07238e55c2fd77f1ece1c7a486_640.jpg","webformatWidth":640,"webformatHeight":392,"largeImageURL":"https://pixabay.com/get/g56de4f8c882515ea6a6d8cc094a695e2915f035c66d54352a52b6195f4933615cdc92a0a2ce8b041745a47b640ee670c691a84e9064f078376b9c90620b77a94_1280.jpg","imageWidth":5503,"imageHeight":3371,"imageSize":3244303,"views":71830,"downloads":50004,"collections":122,"likes":213,"comments":57,"user_id":1767157,"user":"Ralphs_Fotos","userImageURL":"https://cdn.pixabay.com/user/2024/05/26/04-18-55-608_250x250.jpg"},{"id":2788616,"pageURL":"https://pixabay.com/photos/apple-red-red-apple-2788616/","type":"photo","tags":"apple, red, red apple","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/31/apple-2788616_150.jpg","previewWidth":150,"previewHeight":90,"webformatURL":"https://pixabay.com/get/gab7fce4e2e278643bdadd5b78ca139dda90d8933fe89d7a6cf6ada09f2adfd3025b55099033f8d29c2d2cc8fa70327a6231691e8f7ef867e23ba4ff160586317_640.jpg","webformatWidth":640,"webformatHeight":384,"largeImageURL":"https://pixabay.com/get/gba22a1e184afb4099257aeca86113635818ef1850e5dcdbebca3993faaa93299b369d8ec638507659933b5628f772425f4636697f87cfc5c326821c62f77168a_1280.jpg","imageWidth":6000,"imageHeight":3601,"imageSize":2758033,"views":152983,"downloads":94273,"collections":444,"likes":515,"comments":41,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":1952999,"pageURL":"https://pixabay.com/photos/apples-fruits-food-green-apple-1952999/","type":"photo","tags":"apples, fruits, food","previewURL":"https://cdn.pixabay.com/photo/2017/01/04/19/42/apples-1952999_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/gbb2b490d998441db614c77e72fa12dcec319793f5a073b634184a3b670f0ab04a02c0395f152bf615eb40264c77dcca0264e1c10a91c70f48b9225d605e167d8_640.jpg","webformatWidth":426,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g1f749a41bbc31da238529f2f5b92c56017f2a78c7bdd91cbbfd5bc825408a274792ca621b8e2b12de12bd6ba070a200a4cbcc9cd586132093abd360631390d33_1280.jpg","imageWidth":3840,"imageHeight":5760,"imageSize":6482735,"views":45410,"downloads":34120,"collections":231,"likes":194,"comments":16,"user_id":3938704,"user":"Daria-Yakovleva","userImageURL":"https://cdn.pixabay.com/user/2016/12/06/15-05-11-524_250x250.jpg"}]}
""";
